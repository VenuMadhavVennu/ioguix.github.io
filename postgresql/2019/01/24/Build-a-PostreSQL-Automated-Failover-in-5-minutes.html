<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8" />
  <title>Build a PostreSQL Automated Failover in 5 minutes</title>
  <meta name="author" content="Jehan-Guillaume (ioguix) de Rorthais" />
  <link href="http://blog.ioguix.net/feed.xml" rel="alternate" title="Jehan-Guillaume (ioguix) de Rorthais" type="application/atom+xml" >
  <link rel="stylesheet" href="/css/screen.css" type="text/css" media="screen, projection" />
  <link rel="stylesheet" href="/css/syntax.css" type="text/css" />
  
  <link rel="stylesheet" type="text/css" href="/css/asciinema-player.css" /> 
  
  <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet">
</head>
<body>

  <div class="header">
    <a class="title" href="/">ioguix' README</a>
  </div>


  

<div id="content">

  <hr />
  
  <div id="content_infos">
    24 January 2019
    
    <ul class="inline-list">
    
      <li><a href="http://blog.ioguix.net/postgresql/feed.xml">postgresql</a> <i class="fa fa-rss"></i></li>
    
    </ul>
    
    
    <ul class="inline-list">
    
      <li>
        <a href="/tag/postgresql/">postgresql</a>, 
      </li>
    
      <li>
        <a href="/tag/ha/">ha</a>, 
      </li>
    
      <li>
        <a href="/tag/pacemaker/">pacemaker</a>
      </li>
    
      <li><i class="fa fa-tags"></i></li>
    </ul>
    
    
      <a href="#comments">comment</a>
     <i class="fa fa-comment"></i>
  </div>

  <h1>Build a PostreSQL Automated Failover in 5 minutes</h1>

  <br style="clear: both" />

  <p>I’ve been working with <a href="https://www.vagrantup.com/">Vagrant</a> to quickly build a fresh
test cluster for <a href="https://clusterlabs.github.io/PAF/">PAF</a> development. Combined with
<code>virsh</code> snapshot related commands, I save a lot of time when quickly rollback the whole
cluster to a stable situation.</p>

<p>I thought the result might be useful for people that want to challenge such a
cluster, without all the burden to building it and setting everything up. The
<code>Vagrantfile</code> and related files has been pushed to the official PAF repository. Just
look at the <code>test/README.md</code> file there for complete instructions:
<a href="https://github.com/ClusterLabs/PAF">https://github.com/ClusterLabs/PAF</a>.</p>

<p>After very short and easy prerequisites, you’ll be able to build a fresh and ready
cluster with one command and a cup of coffee. It takes about 4 minutes on my laptop to
complete, from creating four new empty VMs to watching at the full cluster status.</p>

<p>And for the busiest of you that want to see it in action, here is a screencast<sup id="fnref:1"><a href="#fn:1" class="footnote">1</a></sup> (about
4 minutes, 7’30” in real speed). It starts on a virgin fedora 29, all prerequisites and
setup are covered, from scratch to a running virtualized demo cluster:</p>

<asciinema-player src="/casts/building-paf-with-vagrant.cast" speed="2" poster="npt:0:1" theme="solarized-dark" cols="99" rows="24" font-size="medium" preload="true"></asciinema-player>

<p>Once you have a running cluster, you can connect to the virtual machines using
<code>vagrant ssh &lt;nodename&gt;</code>. By default, nodes are <code>srv1</code>, <code>srv2</code>, <code>svr3</code> and <code>log-sink</code>.
This last node collect all logs from the cluster nodes and report them in
<code>/var/log/messages</code> and <code>/var/log/&lt;nodename&gt;/</code>.</p>

<p>And if you want some examples about how to exercise the cluster look at this other
screencast (5’32, normal speed):</p>

<asciinema-player src="/casts/testing-paf.cast" poster="npt:0:1" theme="solarized-dark" cols="99" rows="24" font-size="medium" preload="true"></asciinema-player>

<p>If you want to go deeper with PAF, do not forget to read
<a href="https://clusterlabs.github.io/PAF/documentation.html">our documentation</a> with attention.
HA is not a matter of some commands copy/pasted from internet. It requires some time,
documentation crawling and lot of tests. HINT: write docs and procedures, lots of them,
and keep them up to date!</p>

<p>Cheers,</p>

<div class="footnotes">
  <ol>
    <li id="fn:1">

      <p>I use <a href="https://github.com/asciinema/">asciinema</a>. For keyboard shortcuts, see
 <a href="https://github.com/asciinema/asciinema-player#keyboard-shortcuts">https://github.com/asciinema/asciinema-player#keyboard-shortcuts</a> <a href="#fnref:1" class="reversefootnote">&#8617;</a></p>
    </li>
  </ol>
</div>


  
<div id="comments">
  <hr />
  <a class="comments" name="comments">Comments</a>&nbsp;Leave a comment <a href="mailto:ioguix+blog@gmail.com?subject=Post:%20Build%20a%20PostreSQL%20Automated%20Failover%20in%205%20minutes">by email</a> or <a href="#disqus_thread">Disqus</a>
  <p>Note: I only publish your name/pseudo, mail subject and content. I will NOT publish your email address.</p>

  <p>No comments yet.</p>
  
</div>


  <div id="disqus_thread"></div>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname  = 'ioguix';
    var disqus_identifier = "2019-01-24-Build-a-PostreSQL-Automated-Failover-in-5-minutes";

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>


</div>




  <div class="footer">
    © 2010 - 2016: Jehan-Guillaume (ioguix) de Rorthais
    <a href="mailto:ioguix+blog@gmail.com"><i class="fa fa-envelope"></i></a>
    <a href="http://github.com/ioguix/"><i class="fa fa-github"></i></a>
    <a href="http://blog.ioguix.net/feed.xml"><i class="fa fa-rss"></i></a>
  </div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-52084735-1', 'auto');
  ga('send', 'pageview');

</script>



  <script src="/js/asciinema-player.js"></script>


</body>
</html>
